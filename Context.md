# 가계부 프로젝트 설계 지시 문서 (MVP)

## 0. 목적
엑셀 기반 가계부를 웹/프로그램으로 옮긴다.  
초기(MVP)는 DB 없이 **프로젝트 내부 JSON 파일**로 공통코드/카테고리를 관리하고, 거래(가계부) 데이터는 최소 구조로 시작한다.

필수 화면:
1) 공통코드/카테고리 설정 화면  
2) 가계부 입력 화면  
3) 월별 통계 화면  
4) 년도별 누계 화면  

---

## 1. 핵심 컨셉
- **카테고리(공통코드)는 트리 구조**로 관리한다. (`parentCode` 기반)
- 거래 데이터 저장 시 `categoryCode`는 **항상 최하위(leaf) 코드만 저장**한다.
- 상위 카테고리(예: `수입`, `급여`)는 저장하지 않고, **집계할 때 leaf를 parent로 롤업**하여 계산한다.
- MVP에서는 입력 화면을 **탭으로 나누지 않고 한 화면**에서 처리한다. (향후 확장 가능)

---

## 2. 화면 요구사항

### 2.1 공통코드/카테고리 설정 화면
목표: 입력/통계 화면에서 사용할 카테고리(공통코드)를 정의하고 유지한다.

필수 기능:
- 카테고리 트리 조회(계층 구조 표시)
- 사용 여부(`useYn`) 반영 (미사용은 선택 목록에서 제외 가능)
- 정렬 순서(`sortOrder`) 반영
- (정책) MVP에서는 프로젝트 내부 JSON 파일을 편집하여 관리  
  - UI에서 편집까지 제공할지, Read-only로 둘지는 구현 상황에 따라 결정

권장 정책:
- `depth`는 저장 필수 아님 (부모 관계로 계산 가능)
- `updatedAt`은 변경 이력/버전관리 필요 시에만 의미 있게 활용

---

### 2.2 가계부 입력 화면 (한 화면)
목표: 한 화면에서 거래를 빠르게 입력하고 저장한다.

입력 필드(MVP 최소):
- 카테고리 선택 (예: `수입 > 급여 > 월급` 형태의 단계 선택)
- 날짜
- 금액
- 비고(메모)

카테고리 선택 UX:
- 연동 선택(cascading select) 또는 트리 선택 UI
- **최종 선택은 leaf(최하위)만 가능**하도록 설계
- 화면에는 “경로 표시” 지원  
  - 예: `수입 > 급여 > 월급`

저장 규칙:
- 저장 시 `categoryCode`는 leaf 코드만 저장한다.
- 날짜/금액은 필수값
- 비고는 선택값

확장(후순위):
- 결제수단(카드/현금/계좌 등)
- 사용처(merchant)
- 거래 타입(type: INCOME/EXPENSE/TRANSFER/INVEST 등)  
  - MVP에서는 카테고리 루트로도 타입 성격을 유추할 수 있음

---

### 2.3 월별 통계 화면
목표: 월(YYYY-MM) 기준으로 수입/지출 등을 집계한다.

필수 제공(MVP):
- 월 수입 총합
- 월 지출 총합
- 카테고리별 합계
  - leaf 기준 합계
  - 상위 카테고리 합계(leaf 롤업)

권장 제공(가능하면):
- 카테고리별 비중(%)  
  - `카테고리 합계 / 해당 그룹 총합`
- 상위 N 카테고리(Top5/Top10)

---

### 2.4 년도별 누계 화면
목표: 연도(YYYY) 기준 누계 및 추이를 제공한다.

필수 제공(MVP):
- 월별 합계 추이(시계열)
- 연간 카테고리 합계 Top N

권장 제공(가능하면):
- 연도 비교(예: 2024 vs 2025)
- 월별 증감(전월 대비)

---

## 3. 데이터 설계 (MVP 최소)

### 3.1 Transaction (거래) 최소 구조
- `id`: string (UUID 등)
- `date`: YYYY-MM-DD
- `amount`: number
- `categoryCode`: string (**leaf 코드만 저장**)
- `memo`: string (optional)

### 3.2 Category/Code (공통코드) 최소 구조
- `code`: string
- `name`: string
- `parentCode`: string | null
- `sortOrder`: number
- `useYn`: boolean
- (optional) `remark`, `updatedAt`

---

## 4. 집계(롤업) 로직 요구사항

### 4.1 트리 구성
- `parentCode`를 이용해 children 맵을 구성한다.
- leaf 판별 기준:
  - `useYn=true`인 자식이 없는 노드 = leaf

### 4.2 월별 집계
- 특정 월의 Transaction만 필터링한다.
- leaf 카테고리별 합계 계산
- 상위 카테고리 합계는 leaf 합계를 parent로 반복 롤업하여 생성한다.

### 4.3 년도별 집계
- 특정 연도의 Transaction만 필터링한다.
- 월별 합계 시계열 생성
- 카테고리별 연간 합계(leaf + 롤업) 생성

---

## 5. 구현 순서 (AI 작업 지시)
1) 공통코드 로드 → 트리 유틸 구현
   - children 맵 생성
   - leaf 목록 생성
   - code → “경로 문자열(예: 수입 > 급여 > 월급)” 생성
2) 입력 화면 구현
   - 카테고리 단계 선택 UI
   - 날짜/금액/비고 입력
   - Transaction 저장 (저장 방식: MVP 정책에 맞춰 로컬 저장소/파일/DB 중 선택)
3) 월별 통계 화면 구현
   - 월 필터
   - leaf 집계 + 상위 롤업 집계
4) 년도별 누계 화면 구현
   - 연도 필터
   - 월별 시계열 + 연간 카테고리 합계(Top N)
5) (후순위) 설정 화면에서 공통코드 편집 UI 제공 여부 결정

---

## 6. 반드시 지켜야 할 핵심 원칙
- 거래 데이터의 `categoryCode`는 **항상 leaf(최하위) 코드만 저장**한다.
- 상위 카테고리 합계는 저장하지 말고, **집계 시 leaf → parent로 롤업**하여 계산한다.
- 카테고리 트리는 `parentCode` 기반으로 구축한다.
- MVP는 DB 없이 시작하되, 확장 가능한 구조로 만든다.
